---
title: "NBA Play-by-Play Data Project"
format: html
editor: visual
---

```{r}
library(tidyverse)
```

## Reading NBA Play-by-Play Data (2015-2021)

```{r}
#Reading in NBA Play-by-Play data sets.
nba_2016 <- read_csv("rawdata/csv/NBA_PBP_2015-16.csv")
nba_2017 <- read_csv("rawdata/csv/NBA_PBP_2016-17.csv")
nba_2018 <- read_csv("rawdata/csv/NBA_PBP_2017-18.csv")
nba_2019 <- read_csv("rawdata/csv/NBA_PBP_2018-19.csv")
nba_2020 <- read_csv("rawdata/csv/NBA_PBP_2019-20.csv")
nba_2021 <- read_csv("rawdata/csv/NBA_PBP_2020-21.csv")
```

### Inspection of the data sets to see if they are suitable to merge into one larger data set.

```{r}
#Putting the data sets into a list.
nba_list <- list(nba_2016, nba_2017, nba_2018, nba_2019, nba_2020, nba_2021)

#Getting the union of all column names to see which columns are missing from each dataset.
nba_colnames <- nba_list |> map(names) |> unlist() |> unique() 

#Identifying missing columns.
nba_missingcols <- map(nba_list, ~ setdiff(nba_colnames, names(.x))) |> set_names(2016:2021)
nba_missingcols

## nba_2020 has an extra X column ##
```

### Cleaning of any anomalies in the data.

```{r}
#nba_2020 has an extra column, "X", that the others do not. Going to check if it consists of NA values.
all(is.na(nba_2020$`...41`))

#Dropping the column of NA values from the nba_2020 data set.
nba_2020 <- nba_2020 |> select(-`...41`)
```

### Adding a year column to every data set. When merged together, the year column will identify what data set (year) the observation is from.

```{r}
#Adding a year column..
nba_2016 <- nba_2016 |> mutate(year = 2016)
nba_2017 <- nba_2017 |> mutate(year = 2017)
nba_2018 <- nba_2018 |> mutate(year = 2018)
nba_2019 <- nba_2019 |> mutate(year = 2019)
nba_2020 <- nba_2020 |> mutate(year = 2020)
nba_2021 <- nba_2021 |> mutate(year = 2021)
```

### Verifying compatability between data sets for a merge & merging the data sets

```{r}
#Going to double check that all data sets share the same column names (after removing X).
map(list(nba_2016, nba_2017, nba_2018, nba_2019, nba_2020, nba_2021), names)

#Combining all 6 data sets into one larger data set
nba_combined <- bind_rows(nba_2016, nba_2017, nba_2018, nba_2019, nba_2020, nba_2021)

```

## Subsetting Data

### Selecting Key Columns
```{r}
#Filtering to keep only observations from 2017 and 2018, only keeping columns having to do with shooting and score
pbp_condensed <- nba_combined |>
  filter(year %in% c(2018,2019),
         !is.na(ShotType) | !is.na(FreeThrowShooter)) |>
  select(year, Quarter, HomeTeam, AwayTeam, ShotType, ShotOutcome, ShotDist, 
         FreeThrowShooter, FreeThrowOutcome, FreeThrowNum, HomeScore, AwayScore)
```

### Assigning Point Values for 3-pointers, 2-pointers, and free throws
```{r}
#Assigning points values and placing in a new variable "Points"
pbp_condensed <- pbp_condensed |>
  mutate(
    Points = case_when(
      ShotOutcome == "make" & str_detect(ShotType, "3") ~ 3,
      ShotOutcome == "make" & str_detect(ShotType, "2") ~ 2,
      FreeThrowOutcome == "make" ~ 1,
      TRUE ~ 0
    )
  )

#Checking to verify intended results
pbp_condensed |> 
  select(ShotType, ShotOutcome, FreeThrowOutcome, Points) |>
  head(15)
```

## Exploratory Data Analysis

